---
title: "Project 2"
author: "David Apolinar"
date: "3/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## Pulling Data from Azure Blob Storage

As part of this data pull, we are also filtering data to focus on a single year of data crime.

```{r read CSV file}
library(readr)
library(dplyr)
library(httr)
library(magrittr)
library(tidyr)
library(treemapify)
library(ggplot2)
library(stringr)
library(treemap)
incidents <- read_csv("https://azuredocuments.blob.core.windows.net/phillycrime/phillycrime2016-2019.csv")

# Data has 3 years of information. For this assignment, we selected crime for only 2018.
crime2018 <- incidents[incidents$dispatch_date >= as.Date('2018-01-01') & incidents$dispatch_date < as.Date('2019-01-01'),]

head(crime2018, n=3)
crime2018 <- crime2018 %>% select(dc_dist, psa, dispatch_date_time, location_block, text_general_code, ucr_general, lng, lat, hour_)
names(crime2018)

```
# Choosing a subset of columns using dplyr

```{r drop na}
filtered2018 <- drop_na(crime2018)

filtered2018$location_block<-filtered2018$location_block %>% str_remove_all("BLOCK")
filtered2018


# Unique category names
unique.categories <- filtered2018 %>% select(text_general_code) %>% distinct()

# Counts per category

catgegory.counts <- filtered2018 %>% group_by(text_general_code) %>% summarise(Total=n()) %>% arrange(desc(Total))
```


```{r map}
treemap(catgegory.counts, #Your data frame object
        index=c("text_general_code"),  #A list of your categorical variables
        vSize = "Total",  #This is your quantitative variable
        type="index", #Type sets the organization and color scheme of your treemap
        palette = "Reds",  #Select your color palette from the RColorBrewer presets or make your own.
        title="Philly Crime 2018", #Customize your title
        fontsize.title = 14 #Change the font size of the title
        )

```